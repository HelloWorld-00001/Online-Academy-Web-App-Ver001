<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css">
  <link rel="stylesheet" href="/public/css/style_sign.css">
  <title>IGE- Online Courses HCMUS</title>
</head>

<body>
  <div class="frmContain">
    <div class="container">
      <div class="frmBack">
        <h2 class="my-4" style="color:white">Hello ●ω●</h2>
        <h3 class="my-2" style="color:white">You had an account?</h3>
        <a href="/account/login" class="btn btn-primary" role="button"
          style="background: linear-gradient(45deg, #4876FF, #000080); border-radius: 50px; font-size: 25px; border:none">
          Sign in
        </a>
      </div>
    </div>
    <div class="frmSign">
      <div class="center_">
        <div class="form-content mx-4">
          <div class="login">
            Sign Up
          </div>
          <form method="post" id="frmRegister">
            <div class="input-box">
              <i class="fa fa-user-circle" aria-hidden="true"></i>
              <label for="txtUsername">
                Username
              </label>
              <input name="username" type="text" id="txtUsername" class="form-control" autofocus placeholder="leviCool"
                oninvalid="setCustomValidity('Empty! Please input username')" oninput="setCustomValidity('')" required>
            </div>
            <div class="input-box">
              <i class="fa fa-key" aria-hidden="true"></i>
              <label for="txtPassword">
                Password
              </label>
              <input name="password" type="password" class="form-control" id="txtPassword" placeholder="●●●●●●●●●●"
                oninvalid="invalidPassword(this)" oninput="invalidPassword(this)">
              <span toggle="#txtPassword" class="fa fa-fw fa-eye field-icon toggle-password"
                style="color:rgb(95, 95, 95)"></span>
            </div>
            <div class="column">
              <div class="input-box">
                <i class="fa fa-user" aria-hidden="true"></i>
                <label for="txtName">
                  Fullname
                </label>
                <input name="name" type="text" class="form-control" id="txtName" placeholder="Levi Ackerman"
                  oninvalid="setCustomValidity('Empty! Please input name')" oninput="setCustomValidity('');" required>
              </div>
              <div class="input-box">
                <i class="fa fa-calendar-times-o" aria-hidden="true"></i>
                <label for="txtDOB">
                  Birthday
                </label>
                <input name="dob" type="text" class="form-control" id="txtDOB" oninvalid="invalidDOB(this)"
                  oninput="invalidDOB(this)" required>
              </div>
            </div>
            <div class="input-box">
              <i class="fa fa-envelope" aria-hidden="true"></i>
              <label for="txtEmail">
                Email
              </label>
              <input name="email" type="text" class="form-control" id="txtEmail" placeholder="example@gmail.com"
                oninvalid="setCustomValidity('Empty! Please input email');" oninput="setCustomValidity('');" required>
            </div>
            <div class="check-box">
              <input type="checkbox" id="myCheck" name="myCheck" value="Bike">
              <label for="myCheck"> I agree with your condition</label><br>
            </div>
            <div class="" style="text-align: center;">
              <button type="submit" class="btn btn-primary"
                style="background: linear-gradient(120deg, #4876FF, #000080); border-radius: 50px; font-size: 20px; border:none">
                Sign up
              </button>
            </div>
            <div class="mb-3 mt-2" id="signIn">
              Have an account? <a href="/account/login" style="font-weight:bold; color:dodgerblue">Sign In</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  {{!-- Modal --}}
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content" style="border-radius:0; border:none">
        <div class="modal-header" style="border-radius:0; background-color:#F80040">
          <h4 class="modal-title" style="color: white;"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
            Fail Registeration</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <p id="err_msg" style="font-size:17px"></p>
        </div>
        <div class="modal-footer" style="border: none;">
          <button type="button" style="border: none;" class="btn btn-primary btnChange" data-dismiss="modal">
            Try Again
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
    integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
    crossorigin="anonymous"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>
  <script>
    $('#myModal').modal('hide')

    function invalidDOB(textbox) {
      if (textbox.value === null) {
        textbox.setCustomValidity('Empty! Please input birthday');
      } else {
        textbox.setCustomValidity('');
      }
      return true
    }

    function invalidPassword(textbox) {
      var checkLower = /[a-z]+/.test(textbox.value);
      var checkUpper = /[A-Z]+/.test(textbox.value);
      if (textbox.value.length === 0) {
        textbox.setCustomValidity('Empty! Please input password');
      } else if (textbox.value.length < 8) {
        textbox.setCustomValidity('Password length is at least 8.');
      } else if (checkLower === false) {
        textbox.setCustomValidity('Password has at least one lowercase.');
      } else if (checkUpper === false) {
        textbox.setCustomValidity('Password has at least one uppercase.');
      } else {
        textbox.setCustomValidity('');
      }
      return true
    }

    $('#frmRegister').on('submit', function (e) {
      e.preventDefault();
      const username = document.querySelector('#txtUsername').value;
      const check = document.getElementById("myCheck").checked;
      const email = document.querySelector('#txtEmail').value;

      //Check sự tồn tại
      $.getJSON(`/account/is-available?username=${username}&email=${email}&check=${check}`, function (data) {
        if (data === 'EmailNotExist') {
          document.getElementById("err_msg").innerHTML = "Wrong Email. This Email does not exist";
          $('#myModal').modal('show');
        }

        if (data === 'FailTwo') {
          document.getElementById("err_msg").innerHTML = "Username and Email are already taken";
          $('#myModal').modal('show');
        }

        if (data === 'FailUsername') {
          document.getElementById("err_msg").innerHTML = "Username is already taken";
          $('#myModal').modal('show');
        }

        if (data === 'FailCheck') {
          document.getElementById("err_msg").innerHTML = "Accept us condition to continue";
          $('#myModal').modal('show');
        }

        /* check email trung
        if (data === 'FailEmail') {
            document.getElementById("err_msg").innerHTML = "Email is already taken";
            $('#myModal').modal('show');
        }
        */

        if (data === true) {
          $('#frmRegister').off('submit').submit();
        }

      });
    });

    $('#txtDOB').datetimepicker({
      timepicker: false,
      format: 'd/m/Y',
      mask: true
    });

    $('#txtUsername').select();

    $(".toggle-password").click(function () {
      $(this).toggleClass("fa-eye fa-eye-slash");
      var input = $($(this).attr("toggle"));
      if (input.attr("type") == "password") {
        input.attr("type", "text");
      } else {
        input.attr("type", "password");
      }
    });

  </script>
</body>

</html>